//ole æ—¶é—´å¯¹è±¡
import sys.locale;
import sys.locale.abbrevNames;

namespace time;

class ole {
    ctor( value, ... ) {{ 
        if(type(value)==type.number){  
        	var tm = ..time( , ... );
            if(! VariantTimeToSystemTime( value ,tm)  ) return;
            
            ..table.assign(this,tm);//ç§»é™¤å…ƒè¡¨
        }
        elseif( ..time.istime(value) ){ 
            ..table.assign(this,value);
        };
        else {
        	var tm = ..time( value, ... )
        	if(!tm) return;
        	
        	..table.assign(this,tm);//ç§»é™¤å…ƒè¡¨
        }
        
        var format,locale = ...;
        if(format!==null) this.format=format;
        if(locale!==null) this.locale=locale;
        this.dayofyear = null;
    }}; 
    
    @_meta
}
 
namespace ole{
 
	_meta = {  
		_type = "time.ole.datetime";
		_eq = function(b) {
			return tonumber(owner) == tonumber(b)
		};  
    	_le = function(b) {
			return tonumber(owner) <= tonumber(b)
		} ; 
		_lt = function(b) { 
			return tonumber(owner) < tonumber(b)
		};
		addday = function(span){
			return owner._fromnumber( tonumber(owner)+span )
		} 
		addhour = function(span){
			return owner._fromnumber( ( tonumber(owner)*24 + span)/24 )
		} 
		addminute = function(span){
			return owner._fromnumber( ( tonumber(owner)*1440 + span)/1440 )
		} 
		addsecond = function(span){
			return owner._fromnumber( ( tonumber(owner)*86400 + span)/86400 )
		}
		update = function(){
			return owner._fromnumber(   tonumber(owner) );
		}
		diffhour  = function(tm2){
			return (tonumber(owner) -tonumber(tm2))  /24
		} 
		diffminute = function(tm2){
			return (tonumber(owner) -tonumber(tm2)) /1440
		} 
		diffsecond= function(tm2){
		   return (tonumber(owner) -tonumber(tm2))  /86400
		}
		diffday = function(tm2){
			return (tonumber(owner) -tonumber(tm2))  
		}
		_fromnumber = function(n){
			VariantTimeToSystemTime(n,owner);
			return owner;
		};
		_tonumber = function(){
        	var re,n = SystemTimeToVariantTime(owner,0)
        	return n;
    	};
    	systemFormat = function(format,locale){
    		if(!locale) locale = owner.locale;
    		locale = locale ? ..sys.locale.abbrevNames[locale] : 0x0800 ;
    		format = owner.toSystemFormat(format);
    		
    		var size = ::Kernel32.GetDateFormatW(locale,flags,owner,format,null,0);
    		if( size > 0){
    			var buf = ..raw.buffer((size-1)*2);
    			if( ::Kernel32.GetDateFormatW(Locale,flags,owner,format,buf,size) )
    				format = buf;
    		}

    		size = ::Kernel32.GetTimeFormatW(locale,flags,owner,format,null,0);
    		if( size > 0){
    			var buf = ..raw.buffer((size-1)*2);
    			if( ::Kernel32.GetTimeFormatW(locale,flags,owner,format,buf,size) )
    				return ..string.fromUtf16(buf);
    		}
    	};
    	toSystemFormat = function(format){
    		var f =..string.replace(format : owner[["formatString"]],"\%(\w)",{
				d ="dd";a ="ddd";A ="dddd";B ="MMMM";b ="MMM";m = "MM";y = "yy";Y = "yyyy";H = "HH";I = "hh";M = "mm";S = "ss";p = "tt";Z="Z";
				c = function(){
					var d = ..sys.locale.getString(,0x1F/*_LOCALE_SSHORTDATE*/)
					var t = ..sys.locale.getString(,0x1003/*_LOCALE_STIMEFORMAT*/)
					return d + " " + t;
				};
				x = function(){
					return ..sys.locale.getString(,0x1F/*_LOCALE_SSHORTDATE*/);
				};
				X = function(){
					return ..sys.locale.getString(,0x1003/*_LOCALE_STIMEFORMAT*/);
				};
			});
			
			f = ..string.replace(f,"[YSD]+",..string.lower);
			if(f[1]=='!'#) f = ..string.right(f,-2);
			return f;
    	};
		local = function(copy){
			var tm = copy ?  ..time.ole(owner) : owner; 
			if( !(owner.format && owner.format[1]=='!'#) ){ 
				return tm;
			}
			
			UtcToLocal(null,owner,tm); 
			tm.format = ..string.right(tm.format,-2);
			return tm;
		};
		utc = function(copy){
			var tm = copy ?  ..time.ole(owner) : owner; 
			if( owner.format && owner.format[1]=='!'# ){ 
				return tm;
			}
			
			LocalToUtc(null,owner,tm); 
			tm.format = tm.format ? ('!'+tm.format) : '!%Y/%m/%d %H:%M:%S'; 
			return tm;
		};
    	_tostring = function(format,locale){
    		return owner.systemFormat(format,locale);
    	}; 
    	_serialize = function(kernelCall){
    		if(kernelCall){
    			return ..string.format(`global.import('time.ole') : ..time.ole(%s,"%s")`,tonumber(owner), owner.format); 	
    		}
    		else {
    			return ..string.format(`..time.ole(%s,"%s")`,tonumber(owner), owner.format); 
    		}
    	};
    	_get = function(k,ownerCall){
    		if(k==="format"){
    			if( ownerCall ){
    				return _meta.systemFormat;
    			}
    			
    			return owner.formatString;
    		}
    		elseif(k==="systemFormat"){
    			if( ownerCall ){
    				return _meta.systemFormat;
    			}
    			
    			return owner.toSystemFormat();
    		}
    		
    		return _meta[[k]];
    	};
	} 
	 
	..table.mix(_meta,..time._meta);
	
	now = function(...){
		return ..time.ole(,...);
	}
	
    ::OleAut32 := ..raw.loadDll("OleAut32.dll")
    VariantTimeToSystemTime = ::OleAut32.api("VariantTimeToSystemTime","bool(double vtime,struct& lpSystemTime)");
    SystemTimeToVariantTime = ::OleAut32.api("SystemTimeToVariantTime","bool(struct lpSystemTime,double&pvtime)");  

	UtcToLocal = ::Kernel32.api("SystemTimeToTzSpecificLocalTime","bool(ptr zone,struct src,struct &dst)");  
	LocalToUtc = ::Kernel32.api("TzSpecificLocalTimeToSystemTime","bool(ptr zone,struct src,struct &dst)");  
}

isole = function(v){
	return v@ == ole._meta;
}

//@guide time.ole ç»§æ‰¿è‡ª time å¯¹å•—ï¼Œè¯·å‚è€ƒï¼š[ğŸ“„ time åº“ä½¿ç”¨æŒ‡å—](doc://library-guide/builtin/time/time.html)

/**details(å…³äº OLE æ—¶é—´)

time.ole åˆ™ç»§æ‰¿è‡ª time å¯¹è±¡ï¼Œtime.ole å±äºæ ‡å‡†åº“ï¼Œ
éœ€è¦ç”¨ import è¯­å¥å¯¼å…¥æ‰èƒ½ä½¿ç”¨ã€‚

time æ˜¯ aardio çš„å†…ç½®ç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª SYSTEMTIME ç»“æ„ä½“å¯¹è±¡ï¼Œ
åœ¨æ•°å€¼è¿ç®—æ—¶ä¼šè½¬æ¢ä¸ºé€šç”¨çš„ Unix æ—¶é—´æˆ³ï¼Œä¹Ÿå°±æ˜¯ 1970å¹´1æœˆ1æ—¥ 00:00:00 åˆ° 3000å¹´12æœˆ31æ—¥ 23:59:59 ä¹‹é—´çš„ç§’æ•°ã€‚
è¦æ³¨æ„åŒä¸€æ—¶é—´æ— è®ºæ˜¯è½¬æ¢ä¸º UTC è¿˜æ˜¯æœ¬åœ°æ—¶é—´ï¼ŒUnix æ—¶é—´æˆ³éƒ½æ˜¯ä¸å˜çš„ã€‚

time.ole åœ¨è¿›è¡Œæ•°å€¼è¿ç®—æ—¶ä¼šè½¬æ¢ä¸º OLE æ—¶é—´å€¼ï¼Œ
è¿™æ˜¯ä¸€ä¸ª 64 ä½æµ®ç‚¹æ•°ï¼ˆ double ç±»å‹ï¼‰ï¼Œ
è¡¨ç¤ºè‡ª 1899 å¹´ 12 æœˆ 30 æ—¥ç®—èµ·çš„å¤©æ•°ã€‚
å¹¶ä»¥è´Ÿæ•°è¡¨ç¤º 1899 å¹´ 12 æœˆ 30 æ—¥ä¹‹å‰çš„æ—¶é—´ï¼Œ
å°æ•°éƒ¨åˆ†è¡¨ç¤ºä¸€å¤©å½“ä¸­çš„ç‰‡æ®µæ—¶é—´ã€‚
æ”¯æŒä» `100/01/01` åˆ° `9999/12/31` çš„æ—¶é—´ã€‚å¾ˆæ˜æ˜¾ï¼Œtime.ole å¯ä»¥è¡¨ç¤ºæ›´å¤§çš„æ—¶é—´èŒƒå›´ï¼Œ

ä½†æ˜¯ OLE æ—¶é—´å¹¶æ²¡æœ‰çº¦å®šæ ‡å‡†æ—¶åŒºã€‚
æ‰€ä»¥ time.ole å¯¹è±¡åœ¨è½¬æ¢ UTC ä¸æœ¬åœ°æ—¶é—´ä»¥åï¼ŒOLE æ—¶é—´å€¼ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ã€‚
ä¹Ÿå°±æ˜¯è¯´ time.ole åœ¨è½¬æ¢æ—¶åŒºä»¥åï¼Œå†è½¬æ¢ä¸ºæ•°å€¼æ—¶ä¼šè¿”å›ä¸åŒçš„æ•°å€¼ã€‚
å¦‚æœå¸Œæœ›å¾—åˆ°ç»Ÿä¸€çš„æ•°å€¼ï¼Œåˆ™åº”å½“è°ƒç”¨ utc æ–¹æ³•ä»¥åå†è·å–æ•°å€¼ã€‚

COM æ¥å£ä½¿ç”¨çš„ Variant Timeï¼ˆç±»å‹ VT_DATEï¼‰ å­˜å‚¨çš„ä¹Ÿæ˜¯ OLE æ—¶é—´å€¼ï¼Œ
ä½† aardio çš„ COM æ¥å£ä¼šå°† VT_DATE ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸º time ç±»å‹ã€‚


Excel æ—¥æœŸåºåˆ—å·ï¼ˆExcel date serial numberï¼‰å­˜å‚¨çš„ä¹Ÿæ˜¯ OLE æ—¶é—´å€¼ã€‚

ä½†è¦æ³¨æ„ Excel å­˜åœ¨ä¸€ä¸ªå†å²é—ç•™é—®é¢˜ï¼š

> Excel å°† 1900/1/1 ä½œä¸ºç¬¬ 1 å¤©ï¼Œåˆå°† 1900 é”™è¯¯åœ°è§†ä¸ºé—°å¹´å¤šå‡ºäº†ä¸å­˜åœ¨çš„ 1900/2/29 è¿™ä¸€å¤©ã€‚
> æ‰€ä»¥ Excel åºåˆ—å·åœ¨ 1900/2/29 ä»¥å‰ä¸ OLE æ—¶é—´å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚è€Œåœ¨ 1900/2/29ï¼ˆæ—¥æœŸåºåˆ—å·ä¸º 60ï¼‰ ä¹‹ååˆ™æ˜¯ä¸€æ ·çš„ã€‚åœ¨ Excel çš„æ—¥æœŸå•å…ƒæ ¼ç›´æ¥è¾“å…¥æ•°å€¼åºåˆ—å·å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æ—¥æœŸã€‚
end details**/

/*intellisense()
time.ole(.(__,"%Y/%m/%d %H:%M:%S") = åˆ›å»º OLE æ—¶é—´å¯¹è±¡ï¼Œ\nè¿”å›å¯¹è±¡å¯ä¼ å…¥å…¶ä»–çº¿ç¨‹ä½¿ç”¨ã€‚\næ­¤å¯¹è±¡ç»§æ‰¿è‡ª time å¯¹è±¡ï¼ŒåŸºæœ¬ç”¨æ³•ç›¸åŒï¼Œ\nè¯·å‚è€ƒ time åº“æ–‡æ¡£ä¸ä½¿ç”¨æŒ‡å—ã€‚\n\nå‚æ•° @1 å¯æŒ‡å®š OLE æ—¶é—´æ•°å€¼ã€å­—ç¬¦ä¸²ã€æˆ– timeï¼Œtime.ole å¯¹è±¡ï¼Œ\nä¹Ÿå¯ä»¥æŒ‡å®šä»…æä¾› time å¯¹è±¡éƒ¨åˆ†é”®å€¼çš„è¡¨ä½œä¸ºå‚æ•°ã€‚\n\nå‚æ•° @2 å¯é€‰æŒ‡å®šæ ¼å¼åŒ–ä¸²ï¼Œé¦–å­—ç¬¦ä¸º`!`è¡¨ç¤ºä½¿ç”¨ UTC æ—¶åŒºã€‚\nå…¼å®¹ç™¾åˆ†å·ä¸æ— ç™¾åˆ†å·æ ¼å¼åŒ–è¯­æ³•ï¼Œè¯·å‚è€ƒ format å±æ€§è¯´æ˜ã€‚\n\nå¯é€‰ä½¿ç”¨å‚æ•° @3 æŒ‡å®šå¯¹è±¡çš„ locale å±æ€§ï¼Œå³æ–‡æœ¬æ ¼å¼åŒ–ä½¿ç”¨çš„åŒºåŸŸè¯­è¨€ä»£ç ã€‚\nlocale ä¸ setlocale å‡½æ•°æ”¯æŒç›¸åŒçš„è¯­è¨€ä»£ç ï¼Œä¾‹å¦‚ï¼šè‹±æ–‡"enu",ä¸­æ–‡"chs"\n\næ­¤å¯¹è±¡ç»§æ‰¿è‡ª time å¯¹è±¡ï¼Œæ‰€æœ‰åŠŸèƒ½ç›¸åŒã€‚ä¸timeå¯¹è±¡çš„åŒºåˆ«æ˜¯:\nOLE æ—¶é—´å¯¹è±¡åœ¨è¾“å…¥æ•°å€¼æˆ–è½¬æ¢ä¸ºæ•°å€¼æ˜¯æ˜¯ä»¥å¤©æ•°ä¸ºå•ä½çš„,è€Œ time å¯¹è±¡ä»¥ç§’ä¸ºå•ä½.\nOLE æ—¶é—´å¯¹è±¡æ”¯æŒä» 100 å¹´ 1 æœˆ 1 æ—¥åˆ° 9999 å¹´ 12 æœˆ 31 æ—¥çš„æ—¶é—´,æ­£æ•° 1899 å¹´ 12 æœˆ 30 æ—¥ç®—èµ·çš„å¤©æ•°,\nå°æ•°éƒ¨åˆ†æ˜¯ä¸€å¤©å½“ä¸­çš„ç‰‡æ®µæ—¶é—´,è´Ÿæ•°è¡¨ç¤º 1899 å¹´ 12 æœˆ 30 æ—¥ä¹‹å‰çš„æ—¶é—´.\n\næ³¨æ„ï¼šæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²æ—¶è°ƒç”¨ systemFormat å‡½æ•°æ ¼å¼åŒ–,è¯·å‚è€ƒè¯¥å‡½æ•°è¯´æ˜
time.ole() = !time_ole.
time.ole.now() = !time_ole.
time.ole = OLE æ—¶é—´ï¼ˆOLE  Date / Variant Time ï¼‰å¯¹è±¡ã€‚\nè¿›è¡Œæ•°å€¼è¿ç®—æ—¶ä¼šè½¬æ¢ä¸ºè‡ª 1899 å¹´ 12 æœˆ 30 æ—¥ç®—èµ·çš„å¤©æ•° ï¼Œ\nå¹¶ä»¥è´Ÿæ•°è¡¨ç¤º 1899 å¹´ 12 æœˆ 30 æ—¥ä¹‹å‰çš„æ—¶é—´ï¼Œ\nå°æ•°éƒ¨åˆ†è¡¨ç¤ºä¸€å¤©å½“ä¸­çš„ç‰‡æ®µæ—¶é—´ã€‚\n\næ³¨æ„ï¼šæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²æ—¶è°ƒç”¨ systemFormat æ ¼å¼åŒ–ï¼Œè¯·å‚è€ƒè¯¥å‡½æ•°è¯´æ˜ã€‚
time.isole(__) = æ£€æµ‹å‚æ•°ä¸­æŒ‡å®šçš„å€¼æ˜¯å¦time.oleå¯¹è±¡
end intellisense*/

/**intellisense(!time_ole)
year = å¹´
dayofweek = æ˜ŸæœŸã€‚\næ˜ŸæœŸä¸€åˆ°æ˜ŸæœŸå…­çš„å€¼å¯¹åº”æ•°å€¼ä¸º1åˆ°6,æ˜ŸæœŸæ—¥çš„å€¼ä¸º 0,\næ³¨æ„ä¿®æ”¹è¿™ä¸ªå­—æ®µä¸ä¼šæ›´æ–°æ—¶é—´å€¼,\n\nè¿™ä¸ªå­—æ®µåªæœ‰å‚ä¸æ•°å€¼è¿ç®—æˆ–è°ƒç”¨ add*** å‡½æ•°æ‰ä¼šå¡«å……æˆ–æ›´æ–°,\nä¾‹å¦‚è°ƒç”¨ addday(0) ä¼šæ›´æ–°æ­¤å­—æ®µ
day = æ—¥
month = æœˆ
hour = å°æ—¶
minute = åˆ†é’Ÿ
second = ç§’
milliseconds = æ¯«ç§’
endstr = æ–‡æœ¬è§£æä¸ºæ—¶é—´åï¼Œ\næœ€åä¸€ä¸ªæ ¼å¼åŒ–æ ‡è®°è§£ææˆåŠŸå¹¶è·³è¿‡ç©ºç™½å­—ç¬¦ä»¥åçš„å‰©ä½™çš„è¿ç»­ä¸å«ç©ºç™½å­—ç¬¦ä¸²ï¼Œ\nå¯ç”¨äºåç»­è§£æiso8601ç­‰æ ¼å¼çš„æ—¶åŒºï¼ˆè§£æåå°†å¿…é¡»åˆ é™¤ï¼‰ã€‚
locale = æ ¼å¼åŒ–æ—¶é—´ä½¿ç”¨çš„è¯­è¨€ä»£ç ã€‚\nå‚æ•°ä¸ setlocale ç›¸åŒï¼Œè‹±æ–‡"enu",ä¸­æ–‡"chs",\nè¯¥å±æ€§ä¸ºç©ºè¡¨ç¤ºä½¿ç”¨å½“å‰é»˜è®¤è¯­è¨€ã€‚
local( = å°†UTCæ—¶é—´è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ã€‚\nè¦ç‰¹åˆ«æ³¨æ„ time å¯¹è±¡è½¬æ¢ UTC ä¸æœ¬åœ°æ—¶åŒºå¹¶ä¸ä¼šæ”¹æ•°å€¼æ—¶é—´æˆ³ã€‚\nä½†æ˜¯ time.ole è½¬æ¢ UTC ä¸ æœ¬åœ°æ—¶åŒºä»¥åå¯¹åº”çš„ OLE æ—¶é—´æ•°å€¼ä¹Ÿä¼šæ”¹å˜ã€‚
local(.() = å°†UTCæ—¶é—´è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ï¼Œä¿®æ”¹å¹¶è¿”å›è‡ªèº«ã€‚\næ ¼å¼åŒ–ä¸²é¦–å­—ç¬¦ä¸º `!` è¡¨ç¤ºUTFæ—¶é—´ã€‚\nå¦‚æœä¸æ˜¯ UTC æ—¶é—´ç›´æ¥è¿”å›è‡ªèº«ã€‚
local(.(true) = å°† UTC æ—¶é—´è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ï¼Œä¸ä¿®æ”¹è‡ªèº«å¹¶è¿”å›æ–°å¯¹è±¡ã€‚\nå¦‚æœä¸æ˜¯ UTC æ—¶é—´ç›´æ¥å¤åˆ¶å¹¶è¿”å›æ–°å¯¹è±¡ã€‚
utc( = å°†æœ¬åœ°æ—¶é—´è½¬æ¢ä¸º UTC æ—¶é—´ã€‚\nè¦ç‰¹åˆ«æ³¨æ„ time å¯¹è±¡è½¬æ¢ UTC ä¸æœ¬åœ°æ—¶åŒºå¹¶ä¸ä¼šæ”¹æ•°å€¼æ—¶é—´æˆ³ã€‚\nä½†æ˜¯ time.ole è½¬æ¢ UTC ä¸ æœ¬åœ°æ—¶åŒºä»¥åå¯¹åº”çš„ OLE æ—¶é—´æ•°å€¼ä¹Ÿä¼šæ”¹å˜ã€‚
utc(.() = å°†æœ¬åœ°æ—¶é—´è½¬æ¢ä¸º UTC æ—¶é—´ï¼Œä¿®æ”¹å¹¶è¿”å›è‡ªèº«ã€‚\næ ¼å¼åŒ–ä¸²é¦–å­—ç¬¦ä¸º `!` è¡¨ç¤º UTC æ—¶é—´ã€‚\nå¦‚æœå·²ç»æ˜¯ UTC æ—¶é—´ç›´æ¥è¿”å›è‡ªèº«ã€‚
utc(.(true) = å°†æœ¬åœ°æ—¶é—´è½¬æ¢ä¸º UTC æ—¶é—´ï¼Œä¸ä¿®æ”¹è‡ªèº«å¹¶è¿”å›æ–°å¯¹è±¡ã€‚\nå¦‚æœå·²ç»æ˜¯ UTC æ—¶é—´ç›´æ¥å¤åˆ¶å¹¶è¿”å›æ–°å¯¹è±¡ã€‚
update() = é‡æ–°è®¡ç®—æ—¶é—´å¹¶æ›´æ–° dayOfWeek å­—æ®µã€‚
addmonth(__/*è¾“å…¥æ•°å€¼*/) = å¢åŠ æœˆä»½æ•°ï¼Œè¿”å›è‡ªèº«ã€‚
addday(__/*è¾“å…¥æ•°å€¼*/) = å¢åŠ å¤©æ•°ï¼Œå¯ä»¥ä¸ºè´Ÿæ•°ï¼Œè¿”å›è‡ªèº«ã€‚
addsecond(__/*è¾“å…¥æ•°å€¼*/) = å¢åŠ ç§’æ•°ï¼Œå¯ä»¥ä¸ºè´Ÿæ•°ï¼Œè¿”å›è‡ªèº«ã€‚
addminute(__/*è¾“å…¥æ•°å€¼*/) = å¢åŠ åˆ†é’Ÿæ•°ï¼Œå¯ä»¥ä¸ºè´Ÿæ•°ï¼Œè¿”å›è‡ªèº«ã€‚
addhour(__/*è¾“å…¥æ•°å€¼*/) = å¢åŠ å°æ—¶æ•°ï¼Œå¯ä»¥ä¸ºè´Ÿæ•°ï¼Œè¿”å›è‡ªèº«ã€‚
diffmonth(__/*æŒ‡å®šdatetimeå¯¹è±¡*/) = è®¡ç®—ä¸¤ä¸ª time.ole å¯¹è±¡ç›¸å·®æœˆä»½
diffday(__/*æŒ‡å®šdatetimeå¯¹è±¡*/) = è®¡ç®—ä¸¤ä¸ª time.ole å¯¹è±¡ç›¸å·®å¤©æ•°
diffsecond(__/*æŒ‡å®šdatetimeå¯¹è±¡*/) = è®¡ç®—ä¸¤ä¸ª time.ole å¯¹è±¡ç›¸å·®ç§’æ•°
diffminute(__/*æŒ‡å®šdatetimeå¯¹è±¡*/) = è®¡ç®—ä¸¤ä¸ª time.ole å¯¹è±¡ç›¸å·®åˆ†é’Ÿæ•°
diffhour(__/*æŒ‡å®šdatetimeå¯¹è±¡*/) = è®¡ç®—ä¸¤ä¸ª time.ole å¯¹è±¡ç›¸å·®å°æ—¶æ•° 
format = ä½œä¸ºå±æ€§å¯è¯»å†™é»˜è®¤æ ¼å¼åŒ–ä¸²,é¦–å­—ç¬¦ä¸º`!`è¡¨ç¤º GMT æ—¶é—´ã€‚\nä¾‹å¦‚ï¼š "yyyy-mm-dd HH:MM:SS"ã€‚\nå…¼å®¹å¸¦ç™¾åˆ†å·é£æ ¼çš„æ—¶é—´æ ¼å¼ä¸²ï¼Œä¾‹å¦‚  "%Yå¹´%mæœˆ%dæ—¥ %Hæ—¶%Måˆ†%Sç§’" ã€‚\nå…³äºæ ¼å¼åŒ–ä¸²è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ time åº“æ–‡æ¡£ã€‚\nå‚æ•° @2 setlocale å‡½æ•°æ”¯æŒç›¸åŒçš„åŒºåŸŸè¯­è¨€ä»£ç ï¼Œä¾‹å¦‚ï¼šè‹±æ–‡"enu",ä¸­æ–‡"chs"
format(.(æ ¼å¼åŒ–ä¸²,åŒºåŸŸä»£ç ) = ä½œä¸ºæ–¹æ³•è°ƒç”¨ï¼ˆ ownerCall æ–¹å¼ ï¼‰æ—¶å¯æ ¼å¼åŒ–æ—¶é—´å¹¶è¿”å›å­—ç¬¦ä¸²ã€‚\næ‰€æœ‰å‚æ•°å¯é€‰ï¼Œæ ¼å¼åŒ–ä¸²å…¼å®¹ç™¾åˆ†å·ä¸æ— ç™¾åˆ†å·é£æ ¼ï¼Œç¤ºä¾‹ï¼š\n"yyyy-mm-dd HH:MM:SS" æˆ– "%Yå¹´%mæœˆ%dæ—¥ %Hæ—¶%Måˆ†%Sç§’"ã€‚\nå…³äºæ ¼å¼åŒ–ä¸²è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ time åº“æ–‡æ¡£ã€‚\n\nå¯¹äº time.ole å¯¹è±¡æ­¤æ–¹æ³•å®é™…ä¸Šä¼šè°ƒç”¨ systemFormat å‡½æ•°ã€‚
systemFormat(.(æ ¼å¼åŒ–ä¸²,åŒºåŸŸä»£ç ) = ä½œä¸ºæ–¹æ³•è°ƒç”¨ï¼ˆ ownerCall æ–¹å¼ ï¼‰æ—¶ï¼Œ\nä½¿ç”¨ç³»ç»Ÿæ ¼å¼åŒ–è§„åˆ™æ ¼å¼åŒ–æ—¶æœŸ,åŒºåŸŸä»£ç åº”ä½¿ç”¨ 3 å­—æ¯ç¼©å†™ã€‚\næ­¤å‡½æ•°ä½¿ç”¨ä¸å¸¦ç™¾åˆ†å·çš„æ ¼å¼åŒ–è¯­æ³•ï¼Œä½†ä¹Ÿå…¼å®¹å¸¦ç™¾åˆ†å·çš„æ ¼å¼ä¸²,\nå¯¹åº”è§„åˆ™å¦‚ä¸‹ï¼ˆY S D å¿½ç•¥å¤§å°å†™ï¼‰ï¼š\n"%y" -> "yy" è¡¨ç¤º2ä½å¹´ä»½\n"%Y" -> "yyyy" è¡¨ç¤º4ä½å¹´ä»½\n"%B" -> "MMMM" "" è¡¨ç¤ºæœˆä»½å…¨ç§°\n"%b" -> "MMM" è¡¨ç¤ºæœˆä»½ç¼©å†™\n"%m" -> "MM" è¡¨ç¤º2ä½æœˆä»½\n"%d" -> "dd" è¡¨ç¤ºæœˆä»½çš„ç¬¬å‡ å¤©\n"%H" -> "HH" è¡¨ç¤º2ä½24æ—¶åˆ¶å°æ—¶\n"%I" -> "hh" è¡¨ç¤º2ä½12æ—¶åˆ¶å°æ—¶\n"%M" -> "mm" è¡¨ç¤º2ä½åˆ†é’Ÿæ•°\n"%S" -> "ss" è¡¨ç¤º2åˆ†ç§’æ•°\n"%p" -> "tt" è¡¨ç¤º12æ—¶åˆ¶æ˜¾ç¤ºä¸Šåˆæˆ–ä¸‹ã€‚
systemFormat = ä½œä¸ºå±æ€§å¯è¯»å–æ— ç™¾åˆ†å·é£æ ¼çš„æ ¼å¼åŒ–ä¸²ã€‚ \nä¾‹å¦‚ï¼š "yyyy-mm-dd HH:MM:SS"ã€‚\nå¦‚æœ format å±æ€§ä½¿ç”¨äº†ç™¾åˆ†å·é£æ ¼çš„æ ¼å¼ä¸²ï¼Œ\nsystemFormat ä¼šå°†å…¶è½¬æ¢ä¸ºæ— ç™¾åˆ†å·é£æ ¼åè¿”å›ã€‚\nsystemFormat ä¸ä¼šåœ¨é¦–å­—ç¬¦ä½¿ç”¨ `!` æ ‡è®° UTC æ—¶é—´ã€‚\n\næ­¤å±æ€§åªå¯è¯»å–ï¼Œä¸åº”å†™å…¥å…¶ä»–å€¼ï¼Œåº”ä½¿ç”¨ format å±æ€§è¯»å†™æ ¼å¼åŒ–ä¸²ã€‚
addmonth() = !time_ole.
addday() = !time_ole.
addsecond() = !time_ole.
addminute() = !time_ole.
addhour() = !time_ole.
end intellisense**/